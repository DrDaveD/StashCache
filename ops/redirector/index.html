



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://opensciencegrid.org/stashcache/ops/redirector/">
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.4, mkdocs-material-2.8.0">
    
    
      
        <title>Installing XRootD StashCache Federation Redirector - StashCache Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.e8ff00e1.css">
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
      <link rel="stylesheet" href="../../css/extra.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#installing-xrootd-stashcache-federation-redirector" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://opensciencegrid.org/stashcache" title="StashCache Documentation" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                StashCache Documentation
              </span>
              <span class="md-header-nav__topic">
                Installing XRootD StashCache Federation Redirector
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/opensciencegrid/stashcache/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    StashCache Documentation
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/opensciencegrid/stashcache/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../admin/install/" title="Install" class="md-nav__link">
      Install
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Cache server
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Cache server
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../admin/configure-cache/" title="Configuring Cache Server" class="md-nav__link">
      Configuring Cache Server
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../admin/configure-cache-auth/" title="Configuring Cache Server with authentication" class="md-nav__link">
      Configuring Cache Server with authentication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../admin/configure-cache-optional/" title="Optional configuration" class="md-nav__link">
      Optional configuration
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Origin server
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Origin server
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../admin/configure-origin/" title="Configuring Origin Server" class="md-nav__link">
      Configuring Origin Server
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Operations
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Operations
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../register/" title="Registering StashCache and RSV monitoring" class="md-nav__link">
      Registering StashCache and RSV monitoring
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../start/" title="Managing StashCache and associated services" class="md-nav__link">
      Managing StashCache and associated services
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../troubleshoot/" title="Troubleshooting tips" class="md-nav__link">
      Troubleshooting tips
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Installing XRootD StashCache Federation Redirector
      </label>
    
    <a href="./" title="Installing XRootD StashCache Federation Redirector" class="md-nav__link md-nav__link--active">
      Installing XRootD StashCache Federation Redirector
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#redirector-server-recommendations" title="Redirector server recommendations" class="md-nav__link">
    Redirector server recommendations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation-using-yum" title="Installation using yum" class="md-nav__link">
    Installation using yum
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-the-local-server-for-rsv-tests-optional" title="Configure the (local) server for RSV tests (optional)" class="md-nav__link">
    Configure the (local) server for RSV tests (optional)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-the-redirector-for-caches-and-origins" title="Configure the redirector for caches and origins" class="md-nav__link">
    Configure the redirector for caches and origins
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-if-origins-subscribe-to-redirector" title="Test if Origins subscribe to redirector" class="md-nav__link">
    Test if Origins subscribe to redirector
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#useful-project-links" title="Useful Project Links" class="md-nav__link">
    Useful Project Links
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../upgrades/" title="Upgrades" class="md-nav__link">
      Upgrades
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#redirector-server-recommendations" title="Redirector server recommendations" class="md-nav__link">
    Redirector server recommendations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation-using-yum" title="Installation using yum" class="md-nav__link">
    Installation using yum
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-the-local-server-for-rsv-tests-optional" title="Configure the (local) server for RSV tests (optional)" class="md-nav__link">
    Configure the (local) server for RSV tests (optional)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-the-redirector-for-caches-and-origins" title="Configure the redirector for caches and origins" class="md-nav__link">
    Configure the redirector for caches and origins
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-if-origins-subscribe-to-redirector" title="Test if Origins subscribe to redirector" class="md-nav__link">
    Test if Origins subscribe to redirector
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#useful-project-links" title="Useful Project Links" class="md-nav__link">
    Useful Project Links
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/opensciencegrid/stashcache/edit/master/docs/ops/redirector.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="installing-xrootd-stashcache-federation-redirector">Installing XRootD StashCache Federation Redirector</h1>
<p>Use these instructions to install an XRootD StashCache Federation Redirector. These instructions assume that you have SL, CentOS, or RHEL 6.</p>
<h2 id="redirector-server-recommendations">Redirector server recommendations</h2>
<p>The service is very lightweight depending on number of subscribers (caching proxies), though. Recommended would be use machine with 4GB of RAM and 2 cores. Load avg is practically close to zero, therefore 2 cores is sufficient with as much RAM as you can reasonably ask for.  As far as disk goes, something reasonable like 500GB of local storage is good enough, and best if the server has a 10 Gbps NIC at least.</p>
<p>You must have <strong>port</strong> <code>1094</code> and <code>1213</code> open to all traffic; otherwise the redirector will not work.
In addition (this is optional), we run separate xrootd server instance on redirector host for RSV tests which needs open port <code>2094</code>.</p>
<h2 id="installation-using-yum">Installation using yum</h2>
<p>If you don't want to use yum, refer to http://xrootd.org/dload.html for other methods.</p>
<p>Use predefined OSG repo or copy <code>http://xrootd.org/binaries/xrootd-stable-slc6.repo</code> to <code>/etc/yum.repos.d</code>
Do: <code>yum install xrootd</code> and answer every question with y</p>
<h2 id="configure-the-local-server-for-rsv-tests-optional">Configure the (local) server for RSV tests (optional)</h2>
<p>Edit the configuration file <code>/etc/xrootd/xrootd-clustered-server.cfg</code> to look like this:</p>
<pre><code>xrd.port 2094 if exec xrootd
all.adminpath /var/spool/xrootd

all.role server

all.export /stash/
#Production Redirector DNS alias
all.manager redirector.osgstorage.org+ 1213
#ITB Redirector DNS alias
#all.manager stash-itb.osgstorage.org+ 1213

For the RSV test purpose make sure the testing file is present on the file system:
/stash/user/test.1M
</code></pre>

<h2 id="configure-the-redirector-for-caches-and-origins">Configure the redirector for caches and origins</h2>
<ol>
<li>Edit the configuration file (<code>/etc/xrootd/xrootd-clustered.cfg</code>) to look as follows:</li>
</ol>
<pre><code>     all.export   / 
     xrd.allow host * 
     cms.allow host * 
     sec.protocol  host 
     sec.protbind  * none 
     all.adminpath /var/spool/xrootd 
     all.pidpath /var/run/xrootd 

     xrootd.trace emsg login stall redirect 
     ofs.trace all 
     xrd.trace all debug 
     cms.trace all debug 

     xrd.port 1094 
     all.role meta manager 

     #Production Redirector DNS alias
     all.manager meta all redirector.osgstorage.org+ 1213
     all.sitename OSG-StashCache-Redirector 

     #ITB Redirector DNS alias
     #all.manager meta all stash-itb.osgstorage.org+ 1213
     #all.sitename OSG-StashCache-ITB-Redirector
     # XRootD Stats - sends UDP packets
     xrd.report uct2-collectd.mwt2.org:9931
     xrootd.monitor all auth flush 30s window 5s fstat 60 lfn ops xfr 5 dest redir fstat info user uct2-collectd.mwt2.org:9930
</code></pre>

<ol>
<li>Change ownership of these directories:</li>
</ol>
<pre><code>     chown -R xrootd: /var/spool/xrootd
     chown -R xrootd: /var/log/xrootd
     chown -R xrootd: /stash
</code></pre>

<ol>
<li>
<p>Start the service: <code>/etc/init.d/{xrootd,cmsd} start</code></p>
</li>
<li>
<p>Set the service start when machine is rebooted: <code>chkconfig --level 2345 {xrootd,cmsd} on</code></p>
</li>
<li>
<p>Test that your instance works as expected, ideally would be setup origin server and subscribe into this redirector. Then, see the log files if origin server joined the Federation. Now, configure <code>/etc/sysconfig/xrootd</code>.
Assuming host runs both <strong>server and redirector</strong> and the two configurations above are applied, make sure properly edit <code>/etc/sysconfig/xrootd</code> and add/modify these lines:</p>
</li>
</ol>
<pre><code>       XROOTD_DEFAULT_OPTIONS=&quot;-l /var/log/xrootd/xrootd.log -c /etc/xrootd/xrootd-clustered.cfg -k fifo&quot;
       CMSD_DEFAULT_OPTIONS=&quot;-l /var/log/xrootd/cmsd.log -c /etc/xrootd/xrootd-clustered.cfg -k fifo”
       XROOTD_SERVER_OPTIONS=&quot;-l /var/log/xrootd/xrootd.log -c /etc/xrootd/xrootd-clustered-server.cfg -k fifo&quot;
       CMSD_SERVER_OPTIONS=&quot;-l /var/log/xrootd/cmsd.log -c /etc/xrootd/xrootd-clustered-server.cfg -k fifo”
...
...
       XROOTD_INSTANCES=&quot;default server&quot;
       CMSD_INSTANCES=&quot;default server”
</code></pre>

<p>If you don't choose server instance setup for RSV tests you can skip lines XROOTD_SERVER_OPTIONS and CMSD_SERVER_OPTIONS as well as ==server== in the _INSTANCES lines.</p>
<h2 id="test-if-origins-subscribe-to-redirector">Test if Origins subscribe to redirector</h2>
<p>There is command <code>xrdmapc</code> in the xrootd-server packages that you can use to check what Origins subscribe to your redirector:</p>
<pre><code>$ xrdmapc --list all redirector.osgstorage.org:1094
0**** hcc-osg-redirector1.unl.edu:1094
      Srv origin.ligo.caltech.edu:1094
      Srv stashcache.fnal.gov:1094
      Srv stash.osgconnect.net:1094
      Srv csiu.grid.iu.edu:1094
</code></pre>

<h2 id="useful-project-links">Useful Project Links</h2>
<p>https://twiki.opensciencegrid.org/bin/view/SoftwareTeam/SW023_StashCacheDetails
https://twiki.opensciencegrid.org/bin/view/SoftwareTeam/SW023_XrootdAcrossOsg</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../troubleshoot/" title="Troubleshooting tips" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Troubleshooting tips
              </span>
            </div>
          </a>
        
        
          <a href="../upgrades/" title="Upgrades" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Upgrades
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.a59e2a89.js"></script>
      
      <script>app.initialize({version:"0.17.4",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>